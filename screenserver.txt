üß© –í–∞—Ä–∏–∞–Ω—Ç 1. Ubuntu Desktop (X11): —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–º —á–µ—Ä–µ–∑ xset

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ —É —Ç–µ–±—è —Å—Ç–æ–∏—Ç Ubuntu —Å GUI.
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ Qt —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö X11, –∏ —Ç—ã –º–æ–∂–µ—à—å —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–∏—Ç–∞–Ω–∏–µ–º –¥–∏—Å–ø–ª–µ—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –Ω–∞ –æ–±—ã—á–Ω–æ–º –ü–ö.

üîß –ü—Ä–∏–º–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–º –∏–∑ Qt
#include <QProcess>
#include <QTimer>
#include <QGuiApplication>
#include <QEvent>
#include <QObject>

class ScreenController : public QObject {
    Q_OBJECT
public:
    ScreenController(QObject *parent = nullptr) : QObject(parent) {
        connect(&timer, &QTimer::timeout, this, &ScreenController::turnOffScreen);
        timer.start(60000); // 1 –º–∏–Ω—É—Ç–∞ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
    }

    bool eventFilter(QObject*, QEvent *event) override {
        if (event->type() == QEvent::MouseButtonPress ||
            event->type() == QEvent::TouchBegin ||
            event->type() == QEvent::KeyPress) {
            timer.start(60000);
            if (screenOff)
                turnOnScreen();
        }
        return false;
    }

private:
    QTimer timer;
    bool screenOff = false;

    void turnOffScreen() {
        screenOff = true;
        QProcess::execute("xset dpms force off");
    }

    void turnOnScreen() {
        screenOff = false;
        QProcess::execute("xset dpms force on");
    }
};

// –í main.cpp
// qApp->installEventFilter(new ScreenController());


üí° –î–ª—è —ç—Ç–æ–≥–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã:

sudo apt install x11-xserver-utils

üß© –í–∞—Ä–∏–∞–Ω—Ç 2. Wayland (Weston / GNOME Shell)

–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Wayland, –∫–æ–º–∞–Ω–¥—ã xset –∏ xrandr –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç.
–¢–æ–≥–¥–∞ –µ—Å—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

üîπ –ß–µ—Ä–µ–∑ DBus-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å PowerManager
gdbus call --session \
    --dest org.gnome.SettingsDaemon.Power \
    --object-path /org/gnome/SettingsDaemon/Power \
    --method org.gnome.SettingsDaemon.Power.Screen.SetBrightness 0


–í Qt —Ç—ã –º–æ–∂–µ—à—å –≤—ã–∑–≤–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ:

QProcess::execute("gdbus call --session --dest org.gnome.SettingsDaemon.Power "
                  "--object-path /org/gnome/SettingsDaemon/Power "
                  "--method org.gnome.SettingsDaemon.Power.Screen.SetBrightness 0");

üîπ –ò–ª–∏ —á–µ—Ä–µ–∑ Qt API (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Qt 6.5+)

Qt –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–æ–¥—É–ª—å QtPower (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∞—Å–∏—Ç—å —ç–∫—Ä–∞–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ sleep –∏ —Ç.–¥.
–û–¥–Ω–∞–∫–æ –¥–ª—è Ubuntu 22.04 –æ–Ω —á–∞—Å—Ç–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

üß© –í–∞—Ä–∏–∞–Ω—Ç 3. Embedded —Ä–µ–∂–∏–º (DirectFB / DRM / framebuffer)

–ï—Å–ª–∏ Ubuntu —É —Ç–µ–±—è –±–µ–∑ –¥–µ—Å–∫—Ç–æ–ø–∞ (headless, —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º —Ç–≤–æ–µ–≥–æ Qt-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ /dev/fb0 –∏–ª–∏ —á–µ—Ä–µ–∑ EGLFS), —Ç–æ X11 –∏ Wayland –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —ç–∫—Ä–∞–Ω –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

üîπ 1. –ß–µ—Ä–µ–∑ sysfs

–ü–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É —Ç–µ–±—è –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏:

ls /sys/class/backlight/


–Ω–∞–ø—Ä–∏–º–µ—Ä:

backlight_pwm


–¢–æ–≥–¥–∞ –º–æ–∂–µ—à—å —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å —è—Ä–∫–æ—Å—Ç—å:

echo 0 > /sys/class/backlight/backlight_pwm/brightness   # –≤—ã–∫–ª—é—á–∏—Ç—å
echo 255 > /sys/class/backlight/backlight_pwm/brightness # –≤–∫–ª—é—á–∏—Ç—å


–ò–∑ Qt:

#include <QFile>

void setBacklight(int value) {
    QFile f("/sys/class/backlight/backlight_pwm/brightness");
    if (f.open(QIODevice::WriteOnly)) {
        f.write(QByteArray::number(value));
    }
}

‚öôÔ∏è –í–∞—Ä–∏–∞–Ω—Ç 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ HDMI-–≤–∏–¥–µ–æ (RK –¥–∏—Å–ø–ª–µ–π–Ω—ã–π —Å—Ç–µ–∫)

–î–ª—è RK3568 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ drm_mode, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞—Ç—å –≤—ã–≤–æ–¥ HDMI / LVDS / MIPI.

–ù–∞–ø—Ä–∏–º–µ—Ä:

echo off > /sys/class/drm/card0-HDMI-A-1/status
echo on > /sys/class/drm/card0-HDMI-A-1/status


–∏–ª–∏ —á–µ—Ä–µ–∑ drm_info / modetest –∏–∑ –ø–∞–∫–µ—Ç–∞ libdrm-tests.

üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ç–≤–æ–µ–≥–æ —Å–ª—É—á–∞—è

–ü–æ—Å–∫–æ–ª—å–∫—É —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –ø–∞–Ω–µ–ª—å—é –Ω–∞ RK3568 –ø–æ–¥ Ubuntu 22.04, –ª—É—á—à–µ –≤—Å–µ–≥–æ:

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Qt –∏—Å–ø–æ–ª—å–∑—É–µ—Ç EGLFS –∏–ª–∏ Wayland:

echo $QT_QPA_PLATFORM


(–∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å QT_QPA_PLATFORM=eglfs ./your_app).

–ï—Å–ª–∏ EGLFS ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—à—å /sys/class/backlight/... –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π.

–ï—Å–ª–∏ X11/Wayland ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—à—å xset –∏–ª–∏ gdbus.

–ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å: –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ QML, –∞ —Ä–µ–∞–ª—å–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ ‚Äî —á–µ—Ä–µ–∑ C++ –∏ sysfs.

‚öôÔ∏è –ü—Ä–∏–º–µ—Ä QML + C++ –≥–∏–±—Ä–∏–¥

–¢—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:

// screencontrol.h
class ScreenControl : public QObject {
    Q_OBJECT
public slots:
    void setBrightness(int value) {
        QFile f("/sys/class/backlight/backlight_pwm/brightness");
        if (f.open(QIODevice::WriteOnly))
            f.write(QByteArray::number(value));
    }

    void turnOff() { setBrightness(0); }
    void turnOn()  { setBrightness(255); }
};

// screensaver.qml
Rectangle {
    id: saver
    anchors.fill: parent
    color: "black"
    visible: false

    Timer {
        id: t
        interval: 60000
        repeat: false
        onTriggered: {
            saver.visible = true
            screenControl.turnOff()
        }
    }

    MouseArea {
        anchors.fill: parent
        onClicked: {
            saver.visible = false
            screenControl.turnOn()
            t.restart()
        }
    }
}


–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ–¥ EGLFS (–±–µ–∑ X11) ‚Äî —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º Qt-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Ubuntu –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≥–∞—à–µ–Ω–∏–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –¥–∏—Å–ø–ª–µ—è —á–µ—Ä–µ–∑ /sys/class/backlight?
–≠—Ç–æ —Ç–∏–ø–æ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —à–∫–∞—Ñ–æ–≤ –∏ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –ø–∞–Ω–µ–ª–µ–π –Ω–∞ RK3568.

Cha